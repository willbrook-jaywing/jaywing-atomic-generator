//-------------------------------------------------------
//  Library: Data Syncer
//-------------------------------------------------------

var _fs = require('fs');

var _config = require('../../config');

//-------------------------
//  Private
//-------------------------

var _generator;

function _getDocsData() {
  var path = _config.docs.files.global;
  var data = _fs.readFileSync(path, 'utf8');
  return data;
}

function _addSassDefinitionFile(data) {
  var path = data.sassPath + data.sassDefinitionFileName;
  var template = 'definition.scss';
  _generator.fs.copyTpl(_generator.templatePath(template), _generator.destinationPath(path), data);
}

function _addSassSizeFiles(data) {
  for (var i = 0; i < data.sizes.length; i++) {
    var sizeData = data.sizes[i];
    var path = data.sassPath + sizeData.sassFileName;
    var template = 'size.scss';
    _generator.fs.copyTpl(_generator.templatePath(template), _generator.destinationPath(path), sizeData);
  }
}

function _addSassImportFile(data) {
  var path = data.sassPath + data.sassImportFileName;
  var template = 'imports.scss';
  _generator.fs.copyTpl(_generator.templatePath(template), _generator.destinationPath(path), data);
}

function _addModuleFile(data) {
  var path = data.modulePath + data.moduleFileName;
  var template = 'module.js';
  _generator.fs.copyTpl(_generator.templatePath(template), _generator.destinationPath(path), data);
}

//-------------------------
//  Public
//-------------------------

var self = module.exports = {

  init: function (generator) {

    _generator = generator;

  },

  writeDocsData: function (inputDataObj) {

    var docsDataObj = JSON.parse(_getDocsData());
    var pageObj = _DocsDataHelper.extractPageObj(docsDataObj, _inputDataObj.categoryName, _inputDataObj.subCategoryName);
    if(!pageObj) {
      pageObj = _DocsDataHelper.createPageObj(_inputDataObj.categoryName, _inputDataObj.subCategoryName);
      _DocsDataHelper.addPageObjToDocsDataObj(docsDataObj, pageObj);
    }
    var pageItemObj = _DocsDataHelper.createPageItemObj(_inputDataObj.name, _inputDataObj.categoryName);
    _DocsDataHelper.addPageItemObjToPageObj(pageObj, pageItemObj);
    _FileMiner.writeDocsData(docsDataObj);

    // Write to docs data
    var path = _config.docs.files.global;
    var data = JSON.stringify(docsDataObj, null, 2);
    _fs.writeFile(path, data);

  },

  addSassFiles: function (data) {

    _addSassDefinitionFile(data);
    _addSassSizeFiles(data);
    _addSassImportFile(data);

  },

  addModuleFile: function (data) {

    _addModuleFile(data);

  }

};