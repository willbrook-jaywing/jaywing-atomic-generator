//-------------------------------------------------------
//  Library: Data Syncer
//-------------------------------------------------------

var _fs = require('fs');

var _config = require('../../config');

//-------------------------
//  Private
//-------------------------

var _generator;

function _getDocsData() {
  var path = _config.docs.files.global;
  var data = _fs.readFileSync(path, 'utf8');
  return data;
}

function _addSassDefinitionFile(data) {
  var file = data.sassDefinitionFile;
  var template = 'definition.scss';
  _generator.fs.copyTpl(_generator.templatePath(template), _generator.destinationPath(file), data);
}

//-------------------------
//  Public
//-------------------------

var self = module.exports = {

  init: function (generator) {

    _generator = generator;

  },

  writeDocsData: function (inputDataObj) {

    var docsDataObj = JSON.parse(_getDocsData());
    var pageObj = _DocsDataHelper.extractPageObj(docsDataObj, _inputDataObj.categoryName, _inputDataObj.subCategoryName);
    if(!pageObj) {
      pageObj = _DocsDataHelper.createPageObj(_inputDataObj.categoryName, _inputDataObj.subCategoryName);
      _DocsDataHelper.addPageObjToDocsDataObj(docsDataObj, pageObj);
    }
    var pageItemObj = _DocsDataHelper.createPageItemObj(_inputDataObj.name, _inputDataObj.categoryName);
    _DocsDataHelper.addPageItemObjToPageObj(pageObj, pageItemObj);
    _FileMiner.writeDocsData(docsDataObj);

    // Write to docs data
    var path = _config.docs.files.global;
    var data = JSON.stringify(docsDataObj, null, 2);
    _fs.writeFile(path, data);

  },

  addSassFiles: function (inputDataObj) {

    var data = inputDataObj;
    _addSassDefinitionFile(data);

  }

};